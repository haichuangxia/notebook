系统环境变量是一些保存变量的数据类型,如使用jdk运训Java程序时,需要知道jdk的路径,因此可以将jdk的路径保存到一个变量中,通过查询这个变量就可以获取jdk的路径.

Linux中环境变量主要用来定义系统运行环境的一些参数.

<font color=yellow>Linux中,环境变量名称一般是全大写,这是约定俗成的规范</font>

## 1. Linux环境变量的分类

### 1.1. 按照生命周期
#### 1.1.1. 临时环境变量
临时定义的环境变量,当退出shell环境之后,环境变量就失效了.
#### 1.1.2. 永久环境变量
永久性的环境变量,不会因为用户退出shell环境就失效.
### 1.2. 按照作用域
#### 1.2.1. 系统环境变量
环境变量的作用域是整个系统,也就是无论**Alice**还是**Bob**登陆了系统,已经设置的系统环境变量的值不会因为用户的不同而产生差异.

系统环境变量
#### 1.2.2. 用户环境变量
是单个用户设置的环境变量,只有特定用户才能使用,如 **Alice**用户设置的环境变量,**Bob**登陆后就会发现他不能使用**Alice**定义的环境变量.
## 2.常见的环境变量
可以使用`env`命令查询系统的环境变量,常用的环境变量名称和意义如下表:
| 环境变量名称 | 作用                                   |
| ------------ | -------------------------------------- |
| HOME         | 用户的主目录（也称家目录）             |
| SHELL        | 用户使用的 Shell 解释器名称            |
| PATH         | 定义命令行解释器搜索用户执行命令的路径 |
| EDITOR       | 用户默认的文本解释器                   |
| RANDOM       | 生成一个随机数字                       |
| LANG         | 系统语言、语系名称                     |
| HISTSIZE     | 输出的历史命令记录条数                 |
| HISTFILESIZE | 保存的历史命令记录条数                 |
| PS1          | Bash解释器的提示符                     |
| MAIL         | 邮件保存路径                           |

## 3. 设置环境变量
### 3.1. 环境变量有关的文件介绍
| 文件            | 作用                                                                       |
| --------------- | -------------------------------------------------------------------------- |
| ~/.bash_history | 记录用户输入过的历史命令                                                   |
| ~/.bash_logout  | 注销shell时的执行的命令                                                    |
| ~/.bash_profile | 为系统的每个用户设置环境信息,用户登陆时从/etc/profile.d目录中查找shell设置 |
| ~/.bashrc       | 每次使用shell时执行                                                        |
| /etc/profile    | 系统环境变量,对所有用户生效                                                |
### 3.2. 环境变量的设置方法
| 环境变量类型 | 设置方法                                                                              | 优点                                                    | 缺点                                          |
| ------------ | ------------------------------------------------------------------------------------- | ------------------------------------------------------- | --------------------------------------------- |
| 系统环境变量 | 修改/etc下的profile文件                                                               |
|              | <font color=yellow>[推荐]</font> 在/etc/profile.d目录下通过添加sh脚本设置环境变量     | 容易维护,只需要在目录下增删改单个脚本就可以修改环境变量 |
|              | /etc/bashrc文件中设置环境变量                                                         |
| 用户环境变量 | <font color=yellow>[推荐]</font> 在~/.bash_profile文件中设置,如果没有此文件就新建一个 |
|              | 在~/.bashrc中设置                                                                     |                                                         | 每次登陆或打开shell都要读取.bashrc文件,效率低 |
### 3.3. 设置环境变量的基本语法
#### 3.3.1. k=v形式定义
设置环境变量一般使用`VARIABLE=value`的格式进行创建.如设置Java中依赖的路径时`CLASSPATH==/usr/local/jdk-11.0.11/jre/lib`.

#### 3.3.2. `:`分割多个路径

如果一个变量包括多个值,则使用`:`作分隔符,隔开几个值.如PATH环境变量中,`PATH=/usr/local/jdk-11.0.11/bin:/bin:/ust/local/texlive/2022/bin/x86_64-linux:.`

#### 3.3.3. export进行变量传递

不用export设置的环境变量仅对当前shell起作用，不会传导到子进程。export设置的环境变量在子进程也有效。

#### 3.3.4. `.`的作用

`.`代表当前目录,在PATH中设置环境变量时,一般需要加入`.`,不加入`.`则需要使用`./`或者绝对路径.其区别参考来源于REFERENCE-2的图:
![.的作用](https://qingbin.oss-cn-chengdu.aliyuncs.com/img/2022/20221018155156.png)

#### 3.3.5. 使用`$`进行环境变量引用

`$`代表引用环境变量,其在环境变量设置中有以下用法:

##### 3.3.5.1. 查询特定环境变量的值
通过使用`echo $VARIABLE`命令可以查询某个环境变量的值,如`echo $PATH`命令会查询PATH环境变量的值.
##### 3.3.5.2. 引用环境变量
有时候可能要引用已经定义好的环境变量,此时只需要使用`$`符号进行引用就可以.如:
```
export JAVA_HOME=/usr/local/jdk-11.0.11
export PATH=$JAVA_HOME/bin:$PATH:.
```

在上述例子中,使用`$JAVA_HOME`引用已经定义好的`JAVA＿HOME`环境变量,同时,使用`$PATH`引用之前已经定义好的环境变量进行扩充.不同环境变量执行顺序为:
``` mermaid
flowchart LR
sysprofile([/etc/profile])-->sysprofile.d(/etc/profile.d)-->sysbahsrc(/etc/bashrc)-->userprofile(用户的.bash_profile)-->userbashrc([用户的.bashrc])
```


因此,后生效的环境变量可以通过`$`符号调用前面的环境变量.

## 4. 环境变量设置的相关问题
### 4.1. java环境变量不生效的问题

在`/etc/profile.d`目录下，通过shell脚本设置环境变量时，发现Java的版本不对，使用`echo $PATH`命令查看时，发现里面有Java的路径，因此很有可能就是有更高优先级的阻止了shell脚本的生效。

使用`which java`命令查看Java路径时，发现Java的路径为`/usr/bin/java`，这是一个链接文件（执行脚本的时候`run.sh`指的是/usr/bin目录下的run.sh,而`./run.sh`才是表示执行当前路径下的shell脚本）。因此要想让shell脚本生效，就需要删除`/usr/bin/java`文件。

删除之后，再通过`source /etc/profile`命令使得配置文件生效。如果`source`之后还没生效，那么就有可能是缓存的问题，可以重新打开终端或者断开ssh连接之后再试。

## 5. REFERENCE
1. [什么是环境变量,Linux环境变量及作用](http://c.biancheng.net/view/5970.html)
2. [Linux环境变量](https://blog.csdn.net/qq_41962968/article/details/122152904)
3. [Linux中.bash文件讲解](https://cloud.tencent.com/developer/article/1937064)
4. [linux环境变量和对应文件的生效顺序](http://t.zoukankan.com/jiayan666-p-14325036.html)