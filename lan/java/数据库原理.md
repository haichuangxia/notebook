# 关系模型

## 主键

主键约束：任意两条记录不能重复，不能重复不是指两条记录不完全相同，而是指能够通过某个**字段**唯一区分出不同的记录，这个字段被称为*主键*。

选取主键的原则：

- 不要使用与业务相关的作为主键。如果业务需求变量，主键也随之改变，后续会很麻烦。主键最好选业务无关的，该列一般命名为id

#### 联合主键：

多个字段共同作为主键。一般情况下尽量不要使用联合主键，因为会让关系表变复杂。



## 外键

定义外键：foreign key reference：被引用的是**父表**，引用的是**子表**。比如选课信息表，学生和课程是多对多的关系。因此学生-课程表中，需要引用学生id和课程id这两个。因此学生表和课程表是父表，学生-课程表是子表。



# 概述

## 关系完整性

- 实体完整性：主键非空且唯一
- 参照完整性：外键值要么为空，要么等于主键的值
- 用户定义完整性：也叫域完整性，主要包括对字段的一些设置，如设置字段非空，唯一或者Email等格式等有限性，有效性约束

## 关系运算

### 传统集合运算

- 笛卡尔积

  > ​    进行笛卡尔积运算的两个关系不必具有相同的元数。两个分别为**r**目和**s**目的关系**R**和**S**的广义笛卡尔积记为**R×**，它是一个（**r+s**）目的关系。
  >
  > ![example](https://qingbin.oss-cn-chengdu.aliyuncs.com/img/self/202305021045613.png)

### 专门的关系运算

- 投影

> ​    **投影运算是从关系中选取若干个属性的操作**
>
> ![image-20230502104849472](https://qingbin.oss-cn-chengdu.aliyuncs.com/img/2023/20230502104852.png)

- 连接

  > **连接运算是将两个关系模式的若干属性拼接成一个新的关系模式的操作，对应的新关系中，包含满足连接条件的所有元组。**
  >
  > **按照一定的条件将两个关系横向结合在一起，生成一个更宽的新关系的操作称为连接。**
  >
  > ![image-20230502104929672](https://qingbin.oss-cn-chengdu.aliyuncs.com/img/2023/20230502104932.png)

- 自然连接

> **在连接运算中，连接条件为对应属性值相等的连接称为等值连接，去掉重复属性的等值连接称为自然连接。**
>
> 自然连接是等值连接的子集
>
> ![image-20230502105140955](https://qingbin.oss-cn-chengdu.aliyuncs.com/img/2023/20230502105143.png)
>
> 

## 关系规范化(范式)

范式不是一定不能违反，而是大多数时候建议。例如，第二第三范式，有时候不能因为一个字段就去多创建一个数据表，因此可以酌情。但是不能经常违反，否则会有设计问题。

- 第一范式：
> 如果某个域的元素被认为是不可再分的最小数据单元（也称为原子单元），如果一个关系的所有域都是原子的，则称此关系满足第一范式。
>
> 要求：
>
> - 存在主键
> - 每个字段不可再分（不存在组合属性，一个记录中一个字段不可以有多个值）

- 第二范式

  > 所有的非主关键字段都完全依赖于主关键字.（多个字段作为主键时可能违背第二范式）
  >
  > ![image-20230502105655789](https://qingbin.oss-cn-chengdu.aliyuncs.com/img/2023/20230502105657.png)

- 第三范式

  > 关系中的任何两个非主键字段之间不存在函数依赖关系。(没有传递依赖，即没有A→B→C)
  >
  > **要求每个非主键字段必须且只能依赖于主关键字。**
  >
  > ![image-20230502110019340](https://qingbin.oss-cn-chengdu.aliyuncs.com/img/2023/20230502110021.png)
  >
  > （院系名称和院系地址依赖于院系编号，→是决定的意思）
  >
  > ![image-20230502110107039](https://qingbin.oss-cn-chengdu.aliyuncs.com/img/2023/20230502110109.png)

# SQL语句

![image-20230502113838072](https://qingbin.oss-cn-chengdu.aliyuncs.com/img/2023/20230502113841.png)



![image-20230502115830629](https://qingbin.oss-cn-chengdu.aliyuncs.com/img/2023/20230502115833.png)



几种删除策略

| 机制         | 特点                                                         |
| ------------ | ------------------------------------------------------------ |
| 级联         | **在删除模式的同时把该模式中所有的数据库对象全部删除。**     |
| **RESTRICT** | 没有被引用时才可以删除                                       |
|              | **定义了下属的数据库对象（如表、视图等），则拒绝该删除语句的执行** |



级联：主表中的记录更改时，从表中的数据也一并更改。

是否使用级联要根据主表中记录的重要程度来确定，如果很重要，那么从表定义外键时最好还是选择限制策略，这样可以防止误操作。

默认是使用限制策略。



这个策略在哪里都能用。

## 数据查询

常用的查询条件：

| **查 询  条 件**         | **谓  词**                                                   |
| ------------------------ | ------------------------------------------------------------ |
| **比  较**               | **=****,** **>****,**  **<****,** **>=****,** **<=****,** **!=****,** **<>****,**  **!>****,** **!<****;** **NOT+****上述比较运算符** |
| **确定范围**             | **BETWEEN AND****,** **NOT  BETWEEN AND**                    |
| **确定集合**             | **IN****,** **NOT IN**                                       |
| **字符匹配**             | **LIKE****,** **NOT  LIKE**                                  |
| **空  值**               | **IS NULL****,** **IS  NOT NULL**                            |
| **多重条件（逻辑运算）** | **AND****,**  **OR****,**  **NOT**                           |

## 单表查询

聚集函数

| 函数 | 用法 |
| ---- | ---- |
|   COUNT   | 统计总量 |
| sum | 求数值列的和 |
| avg | 数值列的平均值 |
| min/max | 求最值 |



![image-20230502120945138](https://qingbin.oss-cn-chengdu.aliyuncs.com/img/2023/20230502120948.png)

![image-20230502120959346](https://qingbin.oss-cn-chengdu.aliyuncs.com/img/2023/20230502121002.png)

### 连接查询

**连接查询**：同时涉及两个以上的表的查询

相关的术语：

- 连接条件或连接谓词：用来连接两个表的条件
- 连接字段：连接谓词中列的名称（该字段需要为可比类型）

#### 等值与等值连接查询

![image-20230502121346465](https://qingbin.oss-cn-chengdu.aliyuncs.com/img/2023/20230502121349.png)

#### 外连接

##### 左外连接

##### 右外连接

