

# 变量

## 存储类

每个存储类说明符的确切含义取决于两个因素：

- 声明是显示在外部还是内部级别
  - 所有函数定义之外的为**外部级别**
  - 函数定义内的为**内部级别**
- 要声明的项是变量还是函数

存储类定义 C 程序中变量/函数的范围（可见性）和生命周期。这些说明符放置在它们所修饰的类型之前。下面列出 C 程序中可用的存储类：

- auto[default]

- register

  > - 存储类用于定义存储在**寄存器**中而不是 RAM 中的**局部变量**。这意味着变量的最大尺寸等于寄存器的大小（通常是一个词），且不能对它应用一元的 '&' 运算符（因为它没有内存位置）
  > - 寄存器只用于需要**快速访问**的变量，比如计数器
  > - 定义 'register' 并不意味着变量将被存储在寄存器中，它意味着变量**可能**存储在寄存器中，这取决于硬件和实现的限制。

- static

  > - 指示编译器在**程序的生命周期内**保持局部变量的存在，而不需要在每次它进入和离开作用域时进行创建和销毁。因此，使用 static 修饰局部变量可以在函数调用之间保持局部变量的值
  > - static 修饰符也可以应用于全局变量。当 static 修饰全局变量时，会使变量的作用域限制在声明它的文件内。

- extern

  > - **extern** 存储类用于提供一个**全局变量**的引用，全局变量对所有的程序文件都是可见的
  > - 使用extern存储类说明符声明的变量是对另一个源文件中定义的同名变量的引用。 它用于显示外部级别变量定义。
  > -  声明为extern的变量没有为自己分配存储；它只是名称。

| 存储类   | 变量作用域                       | 可见性   |
| -------- | -------------------------------- | -------- |
| auto     | 只能在函数内，即只能修饰局部变量 | 函数内   |
| register |                                  |          |
| static   | 全局 or 局部                     | 文件内   |
| extern   | 全局                             | 所有文件 |



``` c
void sample(){
    // 使用auto作为变量的存储类的两种写法
   int mount;
   auto int month;
    // 使用register定义变量的存储类
     register int  miles;
}
```



extern关键字的应用场景：



support.c

``` c
#include <stdio.h>
 
extern int count;
// 使用static将全局变量的作用域限制为该源文件。
static int num;

// 当前
void write_extern(void)
{
   printf("count is %d\n", count);
}
```

main.c

``` c
#include <stdio.h>
 
int count ;
 // 表明符号没有在当前源文件中定义，链接时需要在其他文件中进行查找
extern void write_extern();
 
int main()
{
   count = 5;
   write_extern();
}
```

关于作用域的说明：

- 全局：文件中在所有函数外定义的
- 局部：在函数内部定义的



## 初始化

定义**全局变量**时，系统会**自动**进行初始化，而定义**局部变量**时，系统**不会**对其进行初始化，必须**手动**进行初始化。

| 数据类型 | 初始化默认值 |
| :------: | :----------: |
|   int    |      0       |
|   char   |     '\0'     |
|  float   |      0       |
|  double  |      0       |
| pointer  |     NULL     |





# 运算符

位运算符：

| 运算符 |                             描述                             |                             实例                             |
| :----: | :----------------------------------------------------------: | :----------------------------------------------------------: |
|   &    | 按位与操作，按二进制位进行"与"运算。运算规则：`0&0=0;    0&1=0;     1&0=0;      1&1=1;` |              (A & B) 将得到 12，即为 0000 1100               |
|   \|   |      按位或运算符，按二进制位进行"或"运算。运算规则：`0      |                            0=0; 0                            |
|   ^    | **异或**运算符，按二进制位进行"异或"运算。运算规则：`0^0=0;    0^1=1;    1^0=1;   1^1=0;` |              (A ^ B) 将得到 49，即为 0011 0001               |
|   ~    | **取反**运算符，按二进制位进行"取反"运算。运算规则：`~1=0;    ~0=1;` | (~A ) 将得到 -61，即为 1100 0011，一个有符号二进制数的补码形式。 |
|   <<   | 二进制左移运算符。将一个运算对象的各二进制位全部左移若干位（左边的二进制位丢弃，右边补0）。 |              A << 2 将得到 240，即为 1111 0000               |
|   >>   | 二进制右移运算符。将一个数的各二进制位全部右移若干位，正数左补0，负数左补1，右边丢弃。 |               A >> 2 将得到 15，即为 0000 1111               |



其他运算符

|  运算符  |       描述       |                 实例                 |
| :------: | :--------------: | :----------------------------------: |
| sizeof() | 返回变量的大小。 | sizeof(a) 将返回 4，其中 a 是整数。  |
|    &     | 返回变量的地址。 |      &a; 将给出变量的实际地址。      |
|    *     |  指向一个变量。  |         *a; 将指向一个变量。         |
|   ? :    |    条件表达式    | 如果条件为真 ? 则值为 X : 否则值为 Y |

运算符优先级：

|    类别    |              运算符               |  结合性  |
| :--------: | :-------------------------------: | :------: |
|    后缀    |         () [] -> . ++ - -         | 从左到右 |
|    一元    |  + - ! ~ ++ - - (type)* & sizeof  | 从右到左 |
|    乘除    |               * / %               | 从左到右 |
|    加减    |                + -                | 从左到右 |
|    移位    |               << >>               | 从左到右 |
|    关系    |             < <= > >=             | 从左到右 |
|    相等    |               == !=               | 从左到右 |
|  位与 AND  |                 &                 | 从左到右 |
| 位异或 XOR |                 ^                 | 从左到右 |
|  位或 OR   |                \|                 | 从左到右 |
| 逻辑与 AND |                &&                 | 从左到右 |
| 逻辑或 OR  |               \|\|                | 从左到右 |
|    条件    |                ?:                 | 从右到左 |
|    赋值    | = += -= *= /= %=>>= <<= &= ^= \|= | 从右到左 |
|    逗号    |                 ,                 | 从左到右 |



# 结构体

定义规则：

``` c
struct tag { 
    member-list
    member-list 
    member-list  
    ...
} variable-list ;
```

说明：

- tag:结构体标签，即结构体的名称
- member-list:成员定义
- variable-list:结构变量

## 位域

C语言中的位域（Bit Field）是一种用于在结构体中节约内存的方法。通常，一个结构体中的各个成员变量都是按照整数的字节数对齐的，这样可能会浪费一些内存空间。而位域可以让我们将结构体的成员变量按照位（bit）对齐，这样可以更加高效地利用内存空间。

在定义结构体时，我们可以使用位域来定义一个或多个成员变量，它们的大小可以是指定的位数，而不是字节数。位域通常使用冒号来指定所占的位数。

``` c
struct bitfield {
    unsigned int x:1; // 定义一个占1位的无符号整型变量x
    unsigned int y:3; // 定义一个占3位的无符号整型变量y
};
// 不同编译器该结构体的长度不同
```



# 数据类型

关于各种数据类型的范围，定义了一些宏表示，基本命名规则为：NAME_MAX 和NAME_MIN

![image-20230509201851529](https://qingbin.oss-cn-chengdu.aliyuncs.com/img/2023/20230509201855.png)





链接确定符号的**可见性**



# 标准库

## limits.h

**limits.h** 头文件决定了各种变量类型的各种属性。定义在该头文件中的宏限制了各种变量类型（比如 char、int 和 long）的值。

这些限制指定了变量不能存储任何超出这些限制的值，例如一个无符号可以存储的最大值是 255。

|     宏     |     值      |                             描述                             |
| :--------: | :---------: | :----------------------------------------------------------: |
|  CHAR_BIT  |      8      |                    定义一个字节的比特数。                    |
| SCHAR_MIN  |    -128     |                 定义一个有符号字符的最小值。                 |
| SCHAR_MAX  |     127     |                 定义一个有符号字符的最大值。                 |
| UCHAR_MAX  |     255     |                 定义一个无符号字符的最大值。                 |
|  CHAR_MIN  |      0      | 定义类型 char 的最小值，如果 char 表示负值，则它的值等于 SCHAR_MIN，否则等于 0。 |
|  CHAR_MAX  |     127     | 定义类型 char 的最大值，如果 char 表示负值，则它的值等于 SCHAR_MAX，否则等于 UCHAR_MAX。 |
| MB_LEN_MAX |      1      |                定义多字节字符中的最大字节数。                |
|  SHRT_MIN  |   -32768    |                   定义一个短整型的最小值。                   |
|  SHRT_MAX  |   +32767    |                   定义一个短整型的最大值。                   |
| USHRT_MAX  |    65535    |                定义一个无符号短整型的最大值。                |
|  INT_MIN   |   -32768    |                    定义一个整型的最小值。                    |
|  INT_MAX   |   +32767    |                    定义一个整型的最大值。                    |
|  UINT_MAX  |    65535    |                 定义一个无符号整型的最大值。                 |
|  LONG_MIN  | -2147483648 |                   定义一个长整型的最小值。                   |
|  LONG_MAX  | +2147483647 |                   定义一个长整型的最大值。                   |
| ULONG_MAX  | 4294967295  |                定义一个无符号长整型的最大值。                |



| 库     | 作用                                           |
| ------ | ---------------------------------------------- |
| math   | 定义常用的数学函数                             |
| signal | 信号量机制                                     |
| stdlib | 包括内存分配和数据类型转换等各种函数，如atoi() |

