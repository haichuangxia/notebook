# 进程的引入

## 进程的基本概念

1. 概念：
	多道程序并行下，程序的一次执行过程

1. 引入进程的目的
	描述并发程序执行时的特征，描述并发执行的动态特性
	
1. 程序顺序执行：
	 1. 定义

        > 一个程序通常有若干程序段组成，程序段必须按照一定先后次序来执行

     2. 特征

        1. 顺序性

        2. 封闭性：

           > 程序一旦开始运行，其执行结果不受外界因素影响

        3. 可再现性

           > 只要程序执行时的初始条件和执行环境相同，当程序重复执行时都将得到相同结果

1. 程序并发执行
	1. 定义
		若干个程序（或程序段）同时在系统中运行，这些程序（程序段）以时间内重叠，一个程序（程序段）还没有结束，另一个就开始执行了（宏观上并行）

     2. 实例
     
        > （I：input   C：calculate   P：print（输出））
        
        >   ![image-20230304105225330](https://qingbin.oss-cn-chengdu.aliyuncs.com/img/2023/20230304105226.png)
        >   （箭头表示先后顺序）

1. 特征
	1. 间断性：并发程序具有“执行-暂停-执行”这种间断性的活动规律

     2. 失去封闭性：程序之间相互影响

     3. 不可再现性：

        > 初始条件相同情况下，程序执行结果依赖于执行次序。即程序与执行结果不是1对1关系，而是1对n
        >
        > 举例：（与时间有关的运行结果）



## 进程的并发条件

1. **两个程序段并发执行不会产生与时间有关的错误**
	>**与时间有关的错误**：
	>
	>​	与时间有关的错误是两个进程访使用一个变量，但是在一个进程还没有结束的时候另一个进程就使用了变量，导致变量的值会出现多种可能
	>**举例**：
	>
	>| 进程1                         | 进程2                           |
	>| ----------------------------- | ------------------------------- |
	>| r1=x;<br /> r1++;<br /> x=r1; | r2=x;<br /> r2++；<br /> x=r2； |
	>
	>**可能的结果**:
	>
	>	1. 进程1执行完之后进程2执行：那结果x=2
	>	1. 进程1执行了一半处理机转去执行进程2，随后又去执行进程1，那结果就为1
	
2. Bernstein条件
	>假定：
	>	 1. 读集：语句执行期间所需引用搞的变量集合，记为$R（S_i）={a_1，…，a_m}$
   >	 1. 写集：语句执行期间要改变的变量集合，记为$W（S_i）={b_1，…，b_n}$
   >	 
   >基本条件：
   >	1. 两进程WR集没有交集，保证两次读之间数据不变：$R        (S_i) ∩ W (S_j) =\varnothing $且$R (Sj_) ∩ W(S_i) =\varnothing $
   >	2. 两进程W集没有交集，保证写操作的结果不会丢失（被覆盖）：$W (Si) ∩ W (Sj) =\varnothing $

## 并发的描述

1. 文字描述

   ``` c
   cobegin
         S1；S2；…Sn；
   coend
   ```

   

2. 前驱图

   ​	![image-20230304110909827](https://qingbin.oss-cn-chengdu.aliyuncs.com/img/2023/20230304110910.png)

## 并发程序利用率分析问题

1. 顺序情况
![image-20230304111128855](https://qingbin.oss-cn-chengdu.aliyuncs.com/img/2023/20230304111130.png)
1. 并发情况
![image-20230304111146656](https://qingbin.oss-cn-chengdu.aliyuncs.com/img/2023/20230304111147.png)
1. 两者对比
	|          | 活动   | 封闭性 | 再现性 |
    | -------- | ------ | ------ | ------ |
    | 顺序执行 | 顺序性 | 是     | 是     |
    | 并发执行 | 间断性 | 否     | 否     |

# 进程的定义

## 进程的定义和组成

### 进程的定义
    进程是程序在处理器上的一次执行过程。
    进程是可以和别的计算并行执行的计算。
    进程是程序在一个数据集合上运行的过程，是系统进行资源分配和调度的一个独立单位。
    进程是一个具有一定功能的程序关于某个数据集合的一次运行活动。 

## 进程的存储

### 进程的存储映像

![image-20230304111748044](https://qingbin.oss-cn-chengdu.aliyuncs.com/img/2023/20230304111748.png)

| 组成部分        | 功能                                                         |
| --------------- | ------------------------------------------------------------ |
| 进程控制块(PCB) | 描述进程本身的特性、进程的状态、进程的调度信息及对资源的占用情况 |
| 用户栈          | 进程在用户模式下使用的栈                                     |
| 核心栈          | 进程在内核模式下运行时使用的堆栈,供中断或系统过程使用        |

### PCB

![image-20230304113139430](https://qingbin.oss-cn-chengdu.aliyuncs.com/img/2023/20230304113140.png)

### 进程的上下文信息

> 用于支持进程执行的环境,包括**CPU现场**和**Cache**中的执行信息
>
> 进程上下文刻画了进程的执行情况

几种不同级别的上下文

| 上下文       | 主要信息                                  |
| ------------ | ----------------------------------------- |
| 用户级上下文 | 用户程序块/用户数据区/用户栈/用户共享内存 |
| 寄存器上下文 | PSW/栈指针/通用寄存器                     |
| 系统级上下文 | PCB/内存区表/核心栈                       |

# 进程的状态

![image-20230304112639300](https://qingbin.oss-cn-chengdu.aliyuncs.com/img/2023/20230304112640.png)

![image-20230304112700676](https://qingbin.oss-cn-chengdu.aliyuncs.com/img/2023/20230304112701.png)

![image-20230304112817032](https://qingbin.oss-cn-chengdu.aliyuncs.com/img/2023/20230304112817.png)

| 状态                                      | 特点                                                         |
| ----------------------------------------- | ------------------------------------------------------------ |
| 就绪                                      | 进程已获得除处理机以外的所有资源，一旦分配了处理机就可以立即执行。 |
| 执行                                      | 又称运行状态。一个进程获得必要的资源并正在处理机上执行       |
| 阻塞状态（blocking）（等待状态/睡眠状态） | 正在执行的进程，由于发生某事件而暂时无法执行下去（如等待输入/输出完成）。这时即使把处理机分配给该进程，它也无法运行。 |
| 新建                                      |                                                              |
| 终止                                      |                                                              |
| 挂起                                      | 某些系统中希望认为将进程挂起使之处于静止状态,将进程从内存调到外存 |

