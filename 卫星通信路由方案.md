## LEO卫星网络

### 优点

全覆盖

低时延(相对其他卫星网络)

### 物理特性

- 硬件受限，性能不足
- 虽然周期性运动，但是星地与星间通断频繁。拓扑结构变化大。（为什么会通断频繁），rip和ospf算法不适用
- 存储受限，因此路由表设计需要尽可能降低**信令比**。（信令：控制和管理通信的东西，如建立连接）

### LEO网络的拓扑结构

分布式的网络结构，但是卫星运动是周期性的。

![image-20230416215924480](C:\Users\qing\AppData\Roaming\Typora\typora-user-images\image-20230416215924480.png)



# 路由协议

## 设计目标

- 时延低
- 持续时间长
- 资源占用少

## 路由特点

![image-20230416220000799](C:\Users\qing\AppData\Roaming\Typora\typora-user-images\image-20230416220000799.png)

常见的问题与解决思路

| 问题                               | 思路         | 方案                               |
| ---------------------------------- | ------------ | ---------------------------------- |
| 拓扑结构变化                       | 避免重构路由 | 预测剩余时间，防止即将失效         |
|                                    |              | 计算可用寿命，失效钱重构路由       |
| 卫星间链路传播时延大，一跳几十毫秒 | 降低路由跳数 | 改进广度优先算法                   |
|                                    |              | 基于跳数和带宽利用率的路由选择     |
| 负载不均                           | 避免拥塞     | 分布式的路由规划                   |
|                                    |              | 基于先验信息获取，实时拥塞感知激活 |
| 资源受限                           |              | 基于SDN的星间路由                  |
|                                    |              |                                    |

# 卫星网络的路由过程

## 卫星网络系统架构

![image-20230417152033827](C:\Users\qing\AppData\Roaming\Typora\typora-user-images\image-20230417152033827.png)

### 虚拟节点和区域划分

![image-20230417152700158](C:\Users\qing\AppData\Roaming\Typora\typora-user-images\image-20230417152700158.png)

## 初始流量预测过程

总体思路：计算自己发送给j的流量多少+相邻节点经自己转发到j的流量多少。

### 地面节点的业务流量

两个虚拟卫星节点之间的流量预计值：

![image-20230417160204788](https://qingbin.oss-cn-chengdu.aliyuncs.com/img/2023/20230417162022.png)

虚拟卫星节点i的地面流入流量计算：

![image-20230417160247295](https://qingbin.oss-cn-chengdu.aliyuncs.com/img/2023/20230417162028.png)

![image-20230417160300904](https://qingbin.oss-cn-chengdu.aliyuncs.com/img/2023/20230417162033.png)

### 邻居卫星节点流入的业务流量

计算当前



![image-20230417160505268](https://qingbin.oss-cn-chengdu.aliyuncs.com/img/2023/20230417162018.png)

参数解释：

| 参数          | 含义                                                         |
| ------------- | ------------------------------------------------------------ |
| $J_{neigh,j}$ | 虚拟节点$V_i$的邻居节点$V_P{neight}$发送到虚拟节点$V_j$的业务流量 |
| B             | 星间链路的容量                                               |

算法解释

> 选择最短路径算法的原因：初始时，各个卫星节点均处于轻负载状态。（最短路径，这个最短是时间最短还是跳数最短–看解释应该是时延最短。所以就不是跳数最短）





# 基于流量预测的动态缓存分配路由策略

系统初始化和运行阶段，分配使用不同的方式预测每条链路的输出流量，然后分配缓存。

## 初始化阶段

计算每条星间链路的输出流量，然后根据各个星见链路的流量比例分配缓存。



### 计算链路K上的业务流量

思路：

计算节点$V_i$经过链路K发送的流量总量：

![image-20230417164203947](C:\Users\qing\AppData\Roaming\Typora\typora-user-images\image-20230417164203947.png)

其中$J_{ij}^k$的计算算法如下：

![image-20230417164340885](C:\Users\qing\AppData\Roaming\Typora\typora-user-images\image-20230417164340885.png)



### 根据业务流量分配缓存

![image-20230417164501749](C:\Users\qing\AppData\Roaming\Typora\typora-user-images\image-20230417164501749.png)

![image-20230417162004124](https://qingbin.oss-cn-chengdu.aliyuncs.com/img/2023/20230417162011.png)

### 算法总体概览

| 参数       | 含义                                                         |
| ---------- | ------------------------------------------------------------ |
| $J_{i,j}$  | 虚拟卫星节点$V_i$发往$V_j$的业务流量                         |
| S          | 星座内低轨卫星的数量                                         |
| $J_{ij}^k$ | 虚拟卫星节点$V_i$通过链路k发送$V_j$($V_j \in V,j \neq i$)的业务流量 |
| $J_i^k$    | 虚拟卫星节点通过链路k的流量                                  |

![image-20230417163038431](https://qingbin.oss-cn-chengdu.aliyuncs.com/img/2023/20230417163041.png)

## 系统运行阶段

在系统运行阶段，需要周期性的监测4条链路上的输出情况，并更新每条链路上的流量预测值。

### 在t时刻，预测流量计算

![image-20230417165323841](C:\Users\qing\AppData\Roaming\Typora\typora-user-images\image-20230417165323841.png)

| 参数             | 含义                                             |
| ---------------- | ------------------------------------------------ |
| $J_{i newavg}^k$ | t时刻输出流量的预测值                            |
| $J_{i oldavg}^k$ | $(0,t-t_{\delta})$时间内的平均输出流量           |
| $J_{inst}^k$     | $(t-t_{\delta},t)$时间内$V_i$经由链路K的输出流量 |
| $t_{\delta}$     | 检测周期                                         |
| α                | 遗忘因子                                         |



遗忘因子α的计算

![image-20230417170729106](https://qingbin.oss-cn-chengdu.aliyuncs.com/img/2023/20230417170731.png)

### 缓存队列的使用情况

| 参数          | 含义                         |
| ------------- | ---------------------------- |
| $Q_k^r$       | 链路k所有的缓存队列的利用率  |
| $Q_k^{α}$     | 判断链路是否为空闲状态的阈值 |
| $Q_k^{\beta}$ | 判断链路是否拥塞的阈值       |

链路的三种状态：

| 缓存队列使用率                         | 状态 |
| -------------------------------------- | ---- |
| $Q_k^r \leq Q_k^{α}$                   | 空闲 |
| $ Q_k^{α} \leq Q_k^r \leq Q_k^{\beta}$ | 正常 |
| $Q_k^r \geq Q_k^{、beta}$              | 拥塞 |

 三个阈值的计算：

##### $Q_k^{\alpha}$的计算

该阈值需要确保再重新进入拥塞状态前有足够时间重新计算路由路径：

![image-20230417175148159](https://qingbin.oss-cn-chengdu.aliyuncs.com/img/2023/20230417175151.png)

$t_{DSP}$:使用最短路径算法计算路由路径的耗时

代入9得：

![image-20230417175331144](C:\Users\qing\AppData\Roaming\Typora\typora-user-images\image-20230417175331144.png)

##### $Q_k^{\beta}$的计算

阈值计算：以缓存队列出现分组丢失现象的依据

![image-20230417171559558](https://qingbin.oss-cn-chengdu.aliyuncs.com/img/2023/20230417171602.png)



![image-20230417171811496](https://qingbin.oss-cn-chengdu.aliyuncs.com/img/2023/20230417171817.png)

| 参数      | 含义                   |
| --------- | ---------------------- |
| $t_d$     | 星间链路的单跳传播时延 |
| $P_{avg}$ | 数据分组的大小         |



### 缓存队列调整

#### 计算单个队列释放出来的缓冲区队列

新缓冲队列长度的计算：

![image-20230417180633759](https://qingbin.oss-cn-chengdu.aliyuncs.com/img/2023/20230417180636.png)

释放出来的缓存资源为：

![image-20230417180737967](C:\Users\qing\AppData\Roaming\Typora\typora-user-images\image-20230417180737967.png)

### 分配空闲队列所释放的缓冲区给拥塞队列

![image-20230417181024313](C:\Users\qing\AppData\Roaming\Typora\typora-user-images\image-20230417181024313.png)

## 业务分流与数据分组转发策略（拥塞处理）

**业务分流策略**：

> 链路k拥塞时，根据数据分组中的上一跳节点地址信息，向相应的邻居卫星节点发送业务分流请求。
